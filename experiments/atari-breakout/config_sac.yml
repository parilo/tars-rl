framework: tensorflow

env:
  name: Breakout-v0
  is_gym: True
  obs_shapes: [[3, 84, 84]]  # list of lists
  obs_dtypes: ['uint8']
  history_length: [4]
  obs_is_image: True
  obs_image_resize_to: [84, 84]
  obs_image_to_grayscale: False
  action_size: 4
  action_postprocess:
    type: "softmax"
  frame_skip: 1
  step_limit: 0
  agent_buffer_size: 5001
  reward_scale: 1.
  reinit_random_action_every: 5
  log_every_n_steps: 1000
  max_episode_length: 5000
  discrete_actions: True
  reward_clip:
    max: 1.

server:
  seed: 42
  num_clients: 16
  experience_replay_buffer_size: 2000000
  use_prioritized_buffer: false
  train_every_nth: 32
  start_learning_after: 50000
  target_critic_update_period: 1
  show_stats_period: 10
  save_model_period: 25000
  ip_address: "0.0.0.0"
  client_start_port: 12977
  logdir: "logs/breakout_sac_asd"
#  load_checkpoint: "logs/breakout_sac_from_eps/model-100000.ckpt"

algo_name: "sac_discrete"

algorithm:
  n_step: 1
  gamma: 0.99
  target_critic_update_rate: 0.001
  h_reward_scale: 1.

nn_engine: "keras"

base_network:
  nn_arch:

    - input: 0
      name: "base_output"
      layers:

        - type: "Scale"
          mult: 0.0078  # 2. / 255
          bias: -0.5

        - type: "Permute"
          args:
            dims: [2, 1, 3, 4]

        - type: "Conv3D"
          args:
            filters: 32
            kernel_size: [2, 8, 8]
            strides: [2, 4, 4]
            padding: "same"
            data_format: "channels_first"
        - type: "Activation"
          args:
            activation: "relu"

        - type: "Conv3D"
          args:
            filters: 64
            kernel_size: [2, 4, 4]
            strides: [2, 2, 2]
            padding: "same"
            data_format: "channels_first"
        - type: "Activation"
          args:
            activation: "relu"

        - type: "Conv3D"
          args:
            filters: 64
            kernel_size: [1, 3, 3]
            strides: [1, 1, 1]
            padding: "same"
            data_format: "channels_first"
        - type: "Activation"
          args:
            activation: "relu"

        - type: "Permute"
          args:
            dims: [2, 1, 3, 4]

        - type: "Reshape"
          args:
            target_shape: [7744]

#        - type: "CuDNNLSTM"
#          args:
#            units: 256

        - type: "Dense"
          args:
            units: 1024
            activation: "relu"

        - type: "Flatten"

        - type: "Dense"
          args:
            units: 512
            activation: "relu"

critic_v:
  base_network: "base_network"
  nn_arch:

    - input: "base_output"
      name: "output"
      layers:

        - type: "Dense"
          args:
            units: 1  # number of actions
            activation: "linear"
            kernel_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003
            bias_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003

critic_q:
  base_network: "base_network"
  nn_arch:

    - input: "base_output"
      name: "output"
      layers:

        - type: "Dense"
          args:
            units: 4  # number of actions
            activation: "linear"
            kernel_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003
            bias_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003

actor:
  base_network: "base_network"
  nn_arch:

    - input: "base_output"
      name: "output"
      layers:

        - type: "Dense"
          args:
            units: 4  # number of actions
            activation: "linear"
            kernel_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003
            bias_initializer:
              class: "RandomUniform"
              module: "tensorflow.python.keras.initializers"
              args:
                minval: -0.003
                maxval: 0.003

critic_optim:
  module: tensorflow.train
  class: AdamOptimizer
  schedule:
    - limit: 0  # of train ops
      lr: 0.0001

actor_optim:
  module: tensorflow.train
  class: AdamOptimizer
  schedule:
    - limit: 0  # of train ops
      lr: 0.0001

training:
  schedule:
    - limit: 0  # of train ops
      batch_size: 256

agents:
  - algorithm_id: 0
    agents:

      - agents_count: 1
        visualize: True

      - agents_count: 1
        exploration:
          type: "boltzmann"
          temp: 0.0001

      - agents_count: 1
        exploration:
          type: "boltzmann"
          temp: 0.001

      - agents_count: 1
        visualize: True
        exploration:
          type: "boltzmann"
          temp: 0.01

      - agents_count: 1
        exploration:
          type: "boltzmann"
          temp: 0.01

      - agents_count: 1
        exploration:
          type: "boltzmann"
          temp: 0.1
